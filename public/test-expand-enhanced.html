<!DOCTYPE html>
<html>
<head>
    <title>Test Enhanced Expand</title>
    <link href="https://cdn.tailwindcss.com" rel="stylesheet">
</head>
<body class="p-8">
    <h1 class="text-2xl font-bold mb-4">Test Enhanced Session Expand</h1>
    
    <div id="error" class="mb-4 p-4 bg-red-50 text-red-600 text-sm hidden"></div>
    <div id="status" class="mb-4 p-4 bg-gray-100 text-sm"></div>
    <div id="sessionsList"></div>
    
    <script>
        window.onerror = function(msg, url, line) {
            document.getElementById('error').classList.remove('hidden');
            document.getElementById('error').innerHTML += msg + ' (line ' + line + ')<br>';
            return false;
        };
        
        // Setup globals
        window.sessions = [{
            sessionId: "TEST-123",
            projectId: "test",
            sprint: "Test Sprint",
            worktree: "test-branch",
            items: 2,
            status: "ready",
            created: new Date().toISOString()
        }];
        window.activeProject = "test";
        window.projects = {};
        window.worktrees = [];
        window.ideas = {
            items: [
                {id: "1", title: "Test Item 1", sprint: "Test Sprint", status: "new"},
                {id: "2", title: "Test Item 2", sprint: "Test Sprint", status: "done"}
            ]
        };
        window.expandedSessionId = null;
    </script>
    
    <script src="session-management.js"></script>
    <script src="session-enhanced.js"></script>
    <script src="dashboard-improvements.js"></script>
    
    <script>
        window.addEventListener('load', () => {
            const status = document.getElementById('status');
            
            // Check functions
            const funcs = [
                'renderEnhancedSessionCardWithTabs',
                'toggleSessionExpand',
                'renderSessionsTab'
            ];
            
            status.innerHTML = funcs.map(f => 
                `${f}: ${typeof window[f]}<br>`
            ).join('');
            
            // Add logging to toggle
            const originalToggle = window.toggleSessionExpand;
            window.toggleSessionExpand = function(sessionId) {
                console.log('Toggle called:', sessionId);
                console.log('Before:', window.expandedSessionId);
                if (originalToggle) originalToggle(sessionId);
                console.log('After:', window.expandedSessionId);
            };
            
            // Render
            if (typeof window.renderSessionsTab === 'function') {
                window.renderSessionsTab();
            }
        });
    </script>
</body>
</html>