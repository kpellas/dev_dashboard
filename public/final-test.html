<!DOCTYPE html>
<html>
<head>
    <title>Final Enhanced Sessions Test</title>
    <link href="https://cdn.tailwindcss.com" rel="stylesheet">
    <script src="session-management.js" defer></script>
    <script src="dashboard-improvements.js" defer></script>
</head>
<body class="p-8 bg-gray-50">
    <h1 class="text-2xl font-bold mb-4">Final Enhanced Sessions Test</h1>
    
    <div class="bg-white rounded-lg shadow p-4 mb-4">
        <h2 class="font-bold mb-2">Function Status:</h2>
        <div id="status" class="font-mono text-sm"></div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-4">
        <h2 class="font-bold mb-4">Sessions (Click cards to expand):</h2>
        <div id="sessionsList"></div>
    </div>
    
    <script>
        // Set up test data
        window.sessions = [
            {
                sessionId: "20250809-Test-feature",
                projectId: "test",
                projectName: "Test Project",
                sprint: "Test Sprint",
                worktree: "test-worktree", 
                items: 2,
                status: "ready",
                state: "in_progress",
                created: new Date().toISOString(),
                checklist: {
                    start: {
                        'git_status': true,
                        'pull_latest': true,
                        'create_branch': false
                    }
                }
            },
            {
                sessionId: "20250809-Critical-fix",
                projectId: "test",
                sprint: "Critical Fixes",
                worktree: "fix-branch",
                items: 3,
                status: "ready",
                created: new Date(Date.now() - 86400000).toISOString()
            }
        ];
        window.activeProject = "test";
        window.projects = {};
        window.worktrees = [];
        window.ideas = {};
        
        window.addEventListener('load', () => {
            // Check functions
            const status = document.getElementById('status');
            const checks = {
                'renderEnhancedSessionCard': typeof window.renderEnhancedSessionCard,
                'renderSessionsTab': typeof window.renderSessionsTab,
                'toggleSessionExpand': typeof window.toggleSessionExpand,
                'SESSION_STATES': typeof window.SESSION_STATES
            };
            
            status.innerHTML = Object.entries(checks).map(([name, type]) => {
                const ok = type !== 'undefined';
                return `<div class="${ok ? 'text-green-600' : 'text-red-600'}">
                    ${ok ? '✓' : '✗'} ${name}: ${type}
                </div>`;
            }).join('');
            
            // Render sessions
            if (typeof window.renderSessionsTab === 'function') {
                console.log('Rendering with renderSessionsTab');
                window.renderSessionsTab();
                
                // Check what was rendered
                const html = document.getElementById('sessionsList').innerHTML;
                if (html.includes('border-2') && html.includes('Expand')) {
                    status.innerHTML += '<div class="text-green-600 font-bold mt-2">✓ ENHANCED SESSIONS ARE WORKING!</div>';
                } else {
                    status.innerHTML += '<div class="text-orange-600 mt-2">⚠ Basic sessions rendered</div>';
                }
            }
        });
    </script>
</body>
</html>